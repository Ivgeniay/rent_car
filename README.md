# Система Аренды Автомобилей

## Описание проекта

Веб-платформа для аренды автомобилей, предоставляющая пользователям удобный интерфейс для поиска, бронирования и оплаты аренды транспортных средств. Система также позволяет владельцам автомобилей размещать свои объявления и передавать автомобили в управление компании.

## Бизнес-модель

Платформа предлагает владельцам автомобилей два варианта сотрудничества:

1. **Самостоятельное размещение** - до N бесплатных объявлений о сдаче автомобиля в аренду
2. **Передача в управление** - заключение договора с фиксированной ежедневной платой за пересдачу автомобиля

## Пользовательские сценарии

### Сценарий 1: Аренда автомобиля (незарегистрированный пользователь)

**Актор:** Гость (незарегистрированный пользователь)

**Предусловие:** Пользователь открыл веб-сайт платформы

**Основной поток:**

1. Пользователь попадает на главную страницу и видит:
   - Header с навигацией
   - Общую информацию об аренде
   - Блок фильтра поиска
   - Список карточек доступных автомобилей

2. Пользователь настраивает фильтр поиска:
   - Выбирает город получения и возврата автомобиля
   - Указывает временной промежуток аренды
   - Применяет дополнительные фильтры (тип кузова, марка, цена и т.д.)

3. Система отображает отфильтрованный список автомобилей

4. Пользователь просматривает карточки автомобилей:
   - Листает изображения автомобиля
   - Видит преимущества (без залога, КАСКО)
   - Сравнивает цены (за сутки и за 14 дней)

5. Пользователь выбирает понравившийся автомобиль и "проваливается" в расширенную карточку

6. На странице расширенной карточки пользователь:
   - Изучает технические характеристики автомобиля
   - Знакомится с условиями аренды
   - Выбирает дополнительные услуги (детское кресло, второй водитель)
   - Нажимает кнопку "Продолжить"

7. Система перенаправляет пользователя на страницу "Бронирование"

8. На странице бронирования пользователь:
   - Видит выбранные даты аренды
   - Выбирает место получения (офис проката / аэропорт с номером рейса / конкретный адрес)
   - Устанавливает время получения (ползунок 0-23 часа)
   - Выбирает место возврата
   - Устанавливает время возврата
   - Знакомится с информацией о тарификации

9. Пользователь заполняет данные основного водителя:
   - Имя и фамилия
   - Дата рождения
   - Email
   - Номер телефона
   - Отмечает доступные мессенджеры (Telegram, WhatsApp, Viber)

10. Система рассчитывает и отображает полную стоимость аренды

11. Пользователь:
    - Знакомится с условиями аренды
    - Ставит галочку "Я принимаю условия использования"
    - Ставит галочку "Я ознакомлен с политикой конфиденциальности"

12. Пользователь нажимает кнопку "Оплатить картой"

13. Система перенаправляет на страницу оплаты

14. Пользователь вводит данные банковской карты и подтверждает оплату

15. Система подтверждает бронирование и отправляет детали на email и в мессенджеры

**Постусловие:** Бронирование создано, оплата произведена, пользователь получил подтверждение

---

### Сценарий 2: Регистрация на платформе

**Актор:** Гость

**Предусловие:** Пользователь находится на сайте

**Основной поток (регистрация по телефону):**

1. Пользователь нажимает кнопку "Регистрация" в Header

2. Система отображает форму регистрации

3. Пользователь вводит номер телефона

4. Опционально: пользователь вводит email

5. Система отправляет код подтверждения на телефон

6. Пользователь вводит полученный код

7. Система проверяет код и создает аккаунт

8. Пользователь перенаправляется в личный кабинет

**Альтернативный поток (авторизация через Telegram):**

1. Пользователь открывает Telegram WebMiniApp

2. Telegram автоматически передает данные пользователя

3. Система создает аккаунт на основе данных Telegram

4. Пользователь получает доступ к функционалу через WebMiniApp

**Постусловие:** Пользователь зарегистрирован и авторизован в системе

---

### Сценарий 3: Настройка личного кабинета

**Актор:** Зарегистрированный пользователь

**Предусловие:** Пользователь авторизован

**Основной поток:**

1. Пользователь нажимает на кнопку "Личный кабинет" в Header

2. Система отображает страницу личного кабинета

3. Пользователь видит разделы:
   - Личная информация
   - Мои бронирования
   - Мои автомобили (если размещал)
   - Настройки аккаунта

4. Пользователь переходит в раздел "Личная информация"

5. Пользователь редактирует данные:
   - Имя
   - Фамилия
   - Контактные данные (телефон, email)
   - Предпочитаемые мессенджеры

6. Пользователь сохраняет изменения

7. Система обновляет данные профиля

**Альтернативный поток (связывание с Telegram):**

1. Пользователь, зарегистрированный по телефону, переходит в настройки

2. Пользователь нажимает "Связать аккаунт Telegram"

3. Система генерирует уникальную ссылку или QR-код

4. Пользователь открывает ссылку в Telegram

5. Telegram бот запрашивает подтверждение связывания

6. Пользователь подтверждает

7. Система связывает аккаунты

**Постусловие:** Личные данные обновлены / аккаунт связан с Telegram

---

### Сценарий 4: Самостоятельное размещение автомобиля

**Актор:** Зарегистрированный владелец автомобиля

**Предусловие:** Пользователь авторизован, у него есть доступные бесплатные слоты для размещения (до N объявлений)

**Основной поток:**

1. Пользователь переходит в личный кабинет

2. Пользователь нажимает кнопку "Разместить автомобиль"

3. Система отображает выбор способа размещения

4. Пользователь выбирает "Самостоятельное размещение"

5. Система отображает форму создания карточки автомобиля

6. Пользователь заполняет карточку:
   - Загружает фотографии автомобиля
   - Указывает марку и модель
   - Заполняет технические характеристики (год выпуска, тип двигателя, объем, КПП, привод, мощность и т.д.)
   - Указывает условия аренды (возраст арендатора, стаж, ограничение пробега)
   - Устанавливает цену за сутки
   - Добавляет дополнительные услуги (детское кресло, второй водитель)
   - Указывает преимущества (без залога, КАСКО)

7. Пользователь отправляет карточку на модерацию

8. Система ставит объявление в очередь модерации

9. Модератор проверяет объявление

10. После одобрения система публикует объявление на сайте

11. Автомобиль становится доступен для аренды всем пользователям

12. Владелец получает уведомление о публикации

**Альтернативный поток (отклонение модерации):**

1. Модератор отклоняет объявление с указанием причины

2. Владелец получает уведомление с причиной отклонения

3. Владелец исправляет замечания и отправляет на повторную модерацию

**Постусловие:** Автомобиль опубликован и доступен для аренды / Объявление отклонено

---

### Сценарий 5: Передача автомобиля в управление компании

**Актор:** Зарегистрированный владелец автомобиля

**Предусловие:** Пользователь авторизован

**Основной поток:**

1. Пользователь переходит в личный кабинет

2. Пользователь нажимает кнопку "Разместить автомобиль"

3. Система отображает выбор способа размещения

4. Пользователь выбирает "Передача в управление"

5. Система отображает форму заявки

6. Пользователь заполняет заявку:
   - Контактная информация (если не заполнена в профиле)
   - Информация об автомобиле (марка, модель, год)
   - Предпочитаемое время для связи
   - Комментарии

7. Пользователь отправляет заявку

8. Система создает заявку и уведомляет менеджера

9. Менеджер связывается с пользователем по указанным контактам

10. Менеджер и владелец договариваются о встрече

11. Менеджер проводит осмотр автомобиля

12. Если автомобиль подходит:
    - Стороны обсуждают условия сотрудничества
    - Подписывают договор с фиксированной ежедневной платой
    - Менеджер фотографирует автомобиль

13. Менеджер создает карточку автомобиля в системе:
    - Загружает фотографии
    - Заполняет все характеристики
    - Устанавливает цену аренды
    - Публикует объявление

14. Автомобиль появляется на сайте

15. Владелец получает уведомление о публикации и начале сотрудничества

**Альтернативный поток (отказ):**

1. После осмотра менеджер отказывает в сотрудничестве

2. Владелец получает уведомление с причиной отказа

**Постусловие:** Договор заключен, автомобиль опубликован / В сотрудничестве отказано

---

### Сценарий 6: Аренда автомобиля (зарегистрированный пользователь)

**Актор:** Зарегистрированный пользователь

**Предусловие:** Пользователь авторизован

**Основной поток:**

1-6. Аналогично сценарию 1 (поиск и выбор автомобиля)

7. Система перенаправляет на страницу "Бронирование"

8. На странице бронирования:
   - Личные данные автоматически подтягиваются из профиля
   - Пользователь выбирает место и время получения/возврата
   - Система рассчитывает стоимость

9. Пользователь проверяет данные, соглашается с условиями

10. Пользователь нажимает "Оплатить картой"

11. Система сохраняет бронирование в истории пользователя

12. После оплаты пользователь может отслеживать бронирование в личном кабинете

**Постусловие:** Бронирование создано и сохранено в истории пользователя

---

### Сценарий 7: Обращение в техподдержку

**Актор:** Любой пользователь (гость или зарегистрированный)

**Предусловие:** Пользователь находится на сайте

**Основной поток:**

1. Пользователь нажимает кнопку "Техподдержка" в Header

2. Система отображает форму обратной связи или открывает чат

3. Пользователь описывает проблему или задает вопрос

4. Если пользователь не авторизован, указывает контактные данные

5. Пользователь отправляет сообщение

6. Система создает обращение и уведомляет оператора техподдержки

7. Оператор обрабатывает обращение и связывается с пользователем

8. Проблема решается или предоставляется необходимая информация

**Постусловие:** Обращение создано и обработано

---

### Сценарий 8: Использование платформы через Telegram WebMiniApp

**Актор:** Пользователь Telegram

**Предусловие:** Пользователь открыл WebMiniApp в Telegram

**Основной поток:**

1. Пользователь открывает бота платформы в Telegram

2. Пользователь запускает WebMiniApp через команду или кнопку меню

3. Telegram автоматически авторизует пользователя

4. Система создает сессию на основе Telegram ID

5. Пользователь получает доступ ко всему функционалу:
   - Поиск автомобилей
   - Бронирование
   - Личный кабинет
   - Размещение автомобилей

6. Все действия выполняются в интерфейсе WebMiniApp

7. Уведомления приходят напрямую в Telegram

**Альтернативный поток (связывание существующего аккаунта):**

1. Пользователь с существующим аккаунтом (по телефону/email) открывает WebMiniApp

2. Система предлагает связать аккаунты

3. Пользователь подтверждает связывание через код или автоматически

4. Аккаунты связываются

**Постусловие:** Пользователь работает с платформой через Telegram

---

## Основной функционал

### Для арендаторов

#### Главная страница
- Header с навигацией и промо-информацией
- Общая информация об аренде
- Фильтр поиска автомобилей
- Список карточек доступных автомобилей

#### Фильтр поиска
Все поля фильтра необязательные для заполнения:

- **Тип кузова**: седан, универсал, минивэн (множественный выбор)
- **Марка автомобиля**: например Toyota, Audi, Honda
- **Тип двигателя**: бензин, дизель, электро, гибрид
- **Привод**: задний, передний, полный (4WD)
- **Цена за сутки**: диапазон (от-до, например от 0 до 1000$)
- **Объем двигателя**: диапазон (например от 0 до 25л)
- **Год выпуска**: минимальный год (например 2005+)
- **Наличие залога**: с залогом / без залога
- **КАСКО**: да / нет

#### Карточка автомобиля в списке

- Галерея изображений с возможностью пролистывания
- Преимущества аренды (например: не требует залог, КАСКО, кредитная карта)
- Цена за сутки и за 14 дней

#### Расширенная карточка автомобиля

**Технические характеристики:**
- Коробка передач (например автоматическая)
- Объем двигателя (например 3.6 л)
- Год выпуска (например 2012 г.)
- Аудиосистема (например AUX)
- Количество мест (например 7)
- Привод (например полный)
- Мощность (например 272 л.с.)
- Наличие подушек безопасности
- Тип кондиционера (например климат 4 зоны)
- Особенности крыши (например люк)
- Объем бака (например 75 л)
- Тип топлива (например бензин)
- Расположение руля (например слева)
- Расход топлива (например 7.4 л/100км)
- Материал салона (например кожа)
- Стеклоподъемники
- Системы безопасности (ABS, EBD, ESP)
- Дополнительное оборудование (круиз-контроль, парктроник, камера заднего вида)

**Условия аренды:**
- Возраст арендатора (например от 23 до 65 лет или от 21 года)
- Минимальный стаж вождения (например от 1 года или от 3 лет)
- Ограничение пробега (например есть/нет или количество км в сутки)

**Дополнительные услуги:**
- Детское кресло (различные категории, например до года, от 3 до 7 лет)
- Второй водитель в договоре
- Цена услуг (бесплатно или платно с указанием стоимости)

#### Страница бронирования

**Информация об аренде:**
- Наименование автомобиля (например Audi Q7)
- Дата получения (например 23 октября - нередактируемое поле)
- Место получения: офис проката, аэропорт (с указанием номера рейса), конкретный адрес
- Время получения (ползунок от 0 до 23 часов)
- Дата возврата (например 6 ноября - нередактируемое поле)
- Время возврата (ползунок от 0 до 23 часов)
- Место возврата

**Тарификация:**
Минимальный тарифицируемый период аренды — 24 часа. Если указывается время возврата позже времени получения, добавляются дополнительные сутки аренды.

**Данные основного водителя:**
- Имя и фамилия
- Дата рождения
- Email
- Номер телефона для связи

**Информация о мессенджерах:**
"Укажите доступные по номеру мессенджеры. Мы будем стараться в первую очередь связываться по ним"
- Telegram
- WhatsApp
- Viber

**Согласия:**
- Чекбокс: "Я принимаю условия использования"
- Чекбокс: "Я ознакомлен с политикой конфиденциальности"

**Оплата:** Кнопка "Оплатить картой"

### Для владельцев автомобилей

#### Личный кабинет
- Управление личными данными (имя, фамилия, контакты)
- Размещение автомобилей на платформе
- История размещений

#### Способы размещения автомобиля

**1. Самостоятельное размещение:**
- Заполнение карточки автомобиля вручную
- Модерация объявления
- Публикация на платформе

**2. Передача в управление:**
- Заполнение заявки с контактными данными
- Связь с менеджером
- Осмотр автомобиля
- Заключение договора
- Размещение объявления менеджером

### Аутентификация и авторизация

**Основные методы:**
- Регистрация по номеру телефона (приоритетный метод)
- Регистрация по email (опционально)

**Дополнительные методы:**
- Авторизация через Telegram (для пользователей Telegram WebMiniApp)
- Связывание аккаунта Telegram в личном кабинете

### Header

- Кнопка регистрации / входа
- Личный кабинет
- Обратная связь с техподдержкой
- Промо-информация для конкретного пользователя

## Технологический стек

### Backend
- **.NET 9** - микросервис авторизации
- **.NET 9** - основной backend API
- **.NET 9** - консольное приложение для Telegram бота

### Frontend
- **React** - библиотека для построения интерфейса
- **TypeScript** - типизированный JavaScript
- **Nginx** - веб-сервер и reverse proxy

### Базы данных и хранилища
- **MSSQL** - основная реляционная база данных
- **ElasticSearch** - полнотекстовый поиск и хранение логов

### Мониторинг и метрики
- **Grafana** - визуализация метрик
- **Prometheus** - сбор и хранение метрик

## Архитектура
Проект построен на:

1. **Основной backend** - бизнес-логика платформы
    1. Auth Service
    2. User Service
    3. Car Service + Listing Service (объединены)
    4. Booking Service
    5. Payment Service
    6. Notification Service + Telegram Bot (объединены)
    7. Search Service

    Общение происходит посредствомQueue (Rabbit MQ)
    Такая конфигурация обеспечивает:

    Разделение ответственности
    Возможность независимого масштабирования
    Управляемую сложность
    Возможность дальнейшего разделения при необходимости


    Коммуникация между сервисами:
    Синхронная (REST/gRPC):

    Проверка доступности автомобиля (Booking → Car)
    Получение информации о пользователе (Booking → User)
    Проверка токена может быть локальной (с публичным ключом)

    Асинхронная (Message Queue - RabbitMQ/Azure Service Bus):

    Отправка уведомлений (любой сервис → Notification)
    Обновление статуса бронирования (Payment → Booking)
    Индексация автомобилей (Car → Search)
    События (UserRegistered, BookingCreated, PaymentCompleted)

2. **Telegram бот** - интеграция с Telegram
3. **Frontend приложение** - пользовательский интерфейс

## Особенности реализации

- Масштабируемая архитектура на основе микросервисов
- Общая библиотека common_library для всех проектов на бекенде (модели данных, DTO, общее поведение и интерфейсы)
- Централизованное логирование через ElasticSearch
- Мониторинг производительности в реальном времени
- Поддержка различных способов авторизации
- Гибкая система фильтрации автомобилей
- Интеграция с Telegram WebMiniApp

---

## Статус проекта

🚧 В разработке